<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>数字の導き</title>
<style>
  :root{ --pp1:#ff8fab; --pp2:#b57aff; }
  body{
    margin:0; background:#fff; color:#000;
    font-family:system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial;
    text-align:center; /* 全体中央揃え */
  }
  header{padding:24px 16px;}
  h1{margin:0 0 10px;font-size:24px}
  p.lead{margin:0;color:#444}
  main{max-width:680px;margin:0 auto;padding:16px}

  .card{
    background:#fff;border:1px solid #ddd;border-radius:12px;padding:20px;
    box-shadow:0 4px 12px rgba(0,0,0,.08);
    display:inline-block; /* 中央寄せ */
    text-align:center;
  }

  label{font-size:14px;color:#444; display:block; margin-bottom:6px}
  input[type="text"]{
    width:80%; max-width:320px;
    padding:10px; border:1px solid #ccc; border-radius:8px; font-size:16px;
    text-align:center;
  }
  .help{font-size:12px;color:#666;margin-top:4px;margin-bottom:16px}

  /* ボタン */
  button{
    padding:12px 32px; border:none; border-radius:28px;
    font-weight:700; font-size:16px; cursor:pointer;
    background:linear-gradient(135deg,var(--pp1),var(--pp2)); color:#fff;
    text-shadow:0 1px 2px rgba(0,0,0,.25);
    box-shadow:0 6px 14px rgba(181,122,255,.35), inset 0 1px 3px rgba(255,255,255,.6);
    transition:transform .2s ease, box-shadow .2s ease, filter .2s ease;
    margin-top:8px;
  }
  button:hover{ transform:translateY(-2px); filter:brightness(1.05) }
  button:active{ transform:translateY(0) }

  .result{
    margin-top:20px;padding:16px;
    border:1px solid #eee;border-radius:10px;
    background:#fafafa; display:inline-block; text-align:center;
    max-width:340px;
  }

  .stars{
    font-size:30px; letter-spacing:2px; line-height:1;
    background:linear-gradient(90deg,var(--pp1),var(--pp2));
    -webkit-background-clip:text; background-clip:text; -webkit-text-fill-color:transparent;
    display:inline-block; position:relative;
  }

  .msg{margin-top:10px;font-size:18px;color:#111}
  .meta{color:#555;font-size:12px;margin-top:6px}
</style>
</head>
<body>
  <header>
    <h1>数字の導き</h1>
    <p class="lead">数秘術であなたの今日の運勢を占います</p>
  </header>

  <main>
    <div class="card">
      <label for="bday">誕生日（YYYY-MM-DD）</label>
      <input id="bday" type="text" inputmode="numeric" placeholder="1990-01-01" maxlength="10">
      <div class="help">※数字8桁（例: 19900101）でもOK。自動で 1990-01-01 に整形します。</div>

      <button id="go" type="button">結果を見る</button>

      <div id="out" class="result" hidden>
        <div id="stars" class="stars">★★★★★</div>
        <div id="message" class="msg"></div>
        <div id="meta" class="meta"></div>
        <div class="meta" style="margin-top:8px">
          ※数秘術を参考に占い結果を作成していますが、あくまでエンタメです。行動の最終判断はご自身で。
        </div>
      </div>
    </div>
  </main>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const bdayEl = document.getElementById('bday');
  const goBtn  = document.getElementById('go');

  bdayEl.addEventListener('input', () => {
    let digits = bdayEl.value.replace(/\D/g, '').slice(0, 8);
    let out = '';
    if (digits.length <= 4) out = digits;
    else if (digits.length <= 6) out = digits.slice(0,4) + '-' + digits.slice(4);
    else out = digits.slice(0,4) + '-' + digits.slice(4,6) + '-' + digits.slice(6);
    bdayEl.value = out;
  });

  function isValidDateISO(s){
    if(!/^\d{4}-\d{2}-\d{2}$/.test(s)) return false;
    const [y,m,d]=s.split('-').map(Number);
    const dt=new Date(s);
    return dt instanceof Date && !isNaN(dt) &&
           dt.getUTCFullYear()===y && dt.getUTCMonth()+1===m && dt.getUTCDate()===d;
  }

  function stringHash(str){let h=2166136261>>>0;for(let i=0;i<str.length;i++){h^=str.charCodeAt(i);h=Math.imul(h,16777619)>>>0;}return h>>>0;}
  function mulberry32(a){return function(){a|=0;a=(a+0x6D2B79F5)|0;let t=Math.imul(a^a>>>15,1|a);t=(t+Math.imul(t^t>>>7,61|t))^t;return ((t^t>>>14)>>>0)/4294967296;}}
  function seededRandom(seedStr){return mulberry32(stringHash(seedStr));}
  function digitalRoot(numStr){let s=numStr.replace(/\D/g,'').split('').reduce((a,b)=>a+Number(b),0);while(s>9){s=String(s).split('').reduce((a,b)=>a+Number(b),0);}return s||0;}
  function lifePathFromDate(isoDate){if(!isoDate)return 0;return digitalRoot(isoDate.replaceAll('-',''));}
  const STAR_WEIGHTS=[0.10,0.25,0.30,0.25,0.10];
  function weightedChoice(rand){const r=rand();let acc=0;for(let i=0;i<STAR_WEIGHTS.length;i++){acc+=STAR_WEIGHTS[i];if(r<=acc)return i+1;}return 5;}
  const BANK={
    1:["無理は禁物。今日は休息優先。","焦りはミスのもと。深呼吸を忘れずに。","下準備が後の力に。土台を整える日に。"],
    2:["ひと工夫で流れが変わる日。","小さな改善が未来を広げる。","周囲を観察するとヒントあり。"],
    3:["いつも通りがベスト。","安定運。丁寧な行動が吉。","欲張らずシンプルに進めよう。"],
    4:["思い切り動けば追い風が吹く。","迷ったら挑戦が正解。","努力が実を結びやすい日。"],
    5:["幸運MAX！行動すれば追い風。","願いが叶いやすい一日。","自信を持って進めば輝ける。"]
  };

  function todayISOLocal(){const n=new Date();return `${n.getFullYear()}-${String(n.getMonth()+1).padStart(2,'0')}-${String(n.getDate()).padStart(2,'0')}`;}
  function starSymbols(n){ return "★★★★★".slice(0,n)+"☆☆☆☆☆".slice(0,5-n); }

  function run(){
    const bday=bdayEl.value.trim();
    if(!isValidDateISO(bday)){ alert('誕生日は YYYY-MM-DD（例：1990-01-01）で入力してください。'); return; }
    const lp=lifePathFromDate(bday);
    const today=todayISOLocal();
    const rand=seededRandom(bday+"|"+today);
    const stars=weightedChoice(rand);
    const idx=Math.floor(rand()*BANK[stars].length);
    const msg=(BANK[stars]||[""])[idx]||"";
    document.getElementById('out').hidden=false;
    document.getElementById('stars').textContent=starSymbols(stars);
    document.getElementById('message').textContent=msg;
    document.getElementById('meta').textContent=`誕生日: ${bday} / 数秘: ${lp} / 日付: ${today}`;
  }

  goBtn.addEventListener('click', run);
  bdayEl.addEventListener('keydown', e=>{ if(e.key==='Enter') run(); });
});
</script>
</body>
</html>
